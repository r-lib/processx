<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Execute and Control System Processes • processx</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Execute and Control System Processes">
<meta name="description" content="Tools to run system processes in the background. It can check if a background process is running; wait on a background process to finish; get the exit status of finished processes; kill background processes. It can read the standard output and error of the processes, using non-blocking connections. processx can poll a process for standard output or error, with a timeout. It can also poll several processes at once.">
<meta property="og:description" content="Tools to run system processes in the background. It can check if a background process is running; wait on a background process to finish; get the exit status of finished processes; kill background processes. It can read the standard output and error of the processes, using non-blocking connections. processx can poll a process for standard output or error, with a timeout. It can also poll several processes at once.">
<meta name="robots" content="noindex">
<script defer data-domain="processx.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">processx</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.8.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/internals.html">processx internals</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/processx/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="processx">processx<a class="anchor" aria-label="anchor" href="#processx"></a>
</h1></div>
<blockquote>
<p>Execute and Control System Processes</p>
</blockquote>
<!-- badges: start -->

<p>Tools to run system processes in the background, read their standard output and error and kill them.</p>
<p>processx can poll the standard output and error of a single process, or multiple processes, using the operating system’s polling and waiting facilities, with a timeout.</p>
<hr>
<ul>
<li><a href="#features">Features</a></li>
<li><a href="#installation">Installation</a></li>
<li>
<a href="#usage">Usage</a>
<ul>
<li>
<a href="#running-an-external-process">Running an external process</a>
<ul>
<li><a href="#errors">Errors</a></li>
<li><a href="#showing-output">Showing output</a></li>
<li><a href="#spinner">Spinner</a></li>
<li><a href="#callbacks-for-io">Callbacks for I/O</a></li>
</ul>
</li>
<li>
<a href="#managing-external-processes">Managing external processes</a>
<ul>
<li><a href="#starting-processes">Starting processes</a></li>
<li><a href="#killing-a-process">Killing a process</a></li>
<li><a href="#standard-output-and-error">Standard output and error</a></li>
<li><a href="#end-of-output">End of output</a></li>
<li><a href="#polling-the-standard-output-and-error">Polling the standard output and error</a></li>
<li><a href="#polling-multiple-processes">Polling multiple processes</a></li>
<li><a href="#waiting-on-a-process">Waiting on a process</a></li>
<li><a href="#exit-statuses">Exit statuses</a></li>
<li><a href="#mixing-processx-and-the-parallel-base-r-package">Mixing processx and the parallel base R package</a></li>
<li><a href="#errors-1">Errors</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#related-tools">Related tools</a></li>
<li><a href="#code-of-conduct">Code of Conduct</a></li>
<li><a href="#license">License</a></li>
</ul>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<ul>
<li>Start system processes in the background and find their process id.</li>
<li>Read the standard output and error, using non-blocking connections</li>
<li>Poll the standard output and error connections of a single process or multiple processes.</li>
<li>Write to the standard input of background processes.</li>
<li>Check if a background process is running.</li>
<li>Wait on a background process, or multiple processes, with a timeout.</li>
<li>Get the exit status of a background process, if it has already finished.</li>
<li>Kill background processes.</li>
<li>Kill background process, when its associated object is garbage collected.</li>
<li>Kill background processes and all their child processes.</li>
<li>Works on Linux, macOS and Windows.</li>
<li>Lightweight, it only depends on the also lightweight R6 and ps packages.</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the stable version from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"processx"</span><span class="op">)</span></span></code></pre></div>
<p>If you need the development version, install it from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"r-lib/processx"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://processx.r-lib.org" class="external-link">processx</a></span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Note: the following external commands are usually present in macOS and Linux systems, but not necessarily on Windows. We will also use the <code>px</code> command line tool (<code>px.exe</code> on Windows), that is a very simple program that can produce output to <code>stdout</code> and <code>stderr</code>, with the specified timings.</p>
</blockquote>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">px</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"processx"</span>, <span class="st">"bin"</span>, <span class="st">"px"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"processx"</span>, <span class="st">"bin"</span>, <span class="va">.Platform</span><span class="op">$</span><span class="va">r_arch</span>, <span class="st">"px.exe"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">px</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">#&gt; [1] "/Users/gaborcsardi/Library/R/arm64/4.2/library/processx/bin/px"</span></span></code></pre></div>
<div class="section level3">
<h3 id="running-an-external-process">Running an external process<a class="anchor" aria-label="anchor" href="#running-an-external-process"></a>
</h3>
<p>The <code><a href="reference/run.html">run()</a></code> function runs an external command. It requires a single command, and a character vector of arguments. You don’t need to quote the command or the arguments, as they are passed directly to the operating system, without an intermediate shell.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="st">"echo"</span>, <span class="st">"Hello R!"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">#&gt; $status</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; $stdout</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; [1] "Hello R!\n"</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; $stderr</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; [1] ""</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; $timeout</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Short summary of the <code>px</code> binary we are using extensively below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="va">px</span>, <span class="st">"--help"</span>, echo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">#&gt; Usage: px [command arg] [command arg] ...</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; Commands:</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt;   sleep  &lt;seconds&gt;           -- sleep for a number os seconds</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt;   out    &lt;string&gt;            -- print string to stdout</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt;   err    &lt;string&gt;            -- print string to stderr</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt;   outln  &lt;string&gt;            -- print string to stdout, add newline</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt;   errln  &lt;string&gt;            -- print string to stderr, add newline</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt;   errflush                   -- flush stderr stream</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt;   cat    &lt;filename&gt;          -- print file to stdout</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt;   return &lt;exitcode&gt;          -- return with exitcode</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt;   writefile &lt;path&gt; &lt;string&gt;  -- write to file</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt;   write &lt;fd&gt; &lt;string&gt;        -- write to file descriptor</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt;   echo &lt;fd1&gt; &lt;fd2&gt; &lt;nbytes&gt;  -- echo from fd to another fd</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt;   getenv &lt;var&gt;               -- environment variable to stdout</span></span></code></pre></div>
<blockquote>
<p>Note: From version 3.0.1, processx does not let you specify a full shell command line, as this involves starting a grandchild process from the child process, and it is difficult to clean up the grandchild process when the child process is killed. The user can still start a shell (<code>sh</code> or <code>cmd.exe</code>) directly of course, and then proper cleanup is the user’s responsibility.</p>
</blockquote>
<div class="section level4">
<h4 id="errors">Errors<a class="anchor" aria-label="anchor" href="#errors"></a>
</h4>
<p>By default <code><a href="reference/run.html">run()</a></code> throws an error if the process exits with a non-zero status code. To avoid this, specify <code>error_on_status = FALSE</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="va">px</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"out"</span>, <span class="st">"oh no!"</span>, <span class="st">"return"</span>, <span class="st">"2"</span><span class="op">)</span>, error_on_status <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co">#&gt; $status</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; $stdout</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt; [1] "oh no!"</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; $stderr</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; [1] ""</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; $timeout</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="showing-output">Showing output<a class="anchor" aria-label="anchor" href="#showing-output"></a>
</h4>
<p>To show the output of the process on the screen, use the <code>echo</code> argument. Note that the order of <code>stdout</code> and <code>stderr</code> lines may be incorrect, because they are coming from two different connections.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="va">px</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"outln"</span>, <span class="st">"out"</span>, <span class="st">"errln"</span>, <span class="st">"err"</span>, <span class="st">"outln"</span>, <span class="st">"out again"</span><span class="op">)</span>,</span>
<span>  echo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co">#&gt; out</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; out again</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; err</span></span></code></pre></div>
<p>If you have a terminal that support ANSI colors, then the standard error output is shown in red.</p>
<p>The standard output and error are still included in the result of the <code><a href="reference/run.html">run()</a></code> call:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co">#&gt; $status</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; $stdout</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; [1] "out\nout again\n"</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; $stderr</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; [1] "err\n"</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; $timeout</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Note that <code><a href="reference/run.html">run()</a></code> is different from <code><a href="https://rdrr.io/r/base/system.html" class="external-link">system()</a></code>, and it always shows the output of the process on R’s proper standard output, instead of writing to the terminal directly. This means for example that you can capture the output with <code><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output()</a></code> or use <code><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink()</a></code>, etc.:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"ls"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="st">"ls"</span>, echo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out1</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co">#&gt; character(0)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out2</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co">#&gt;  [1] "CODE_OF_CONDUCT.md" "DESCRIPTION"        "LICENSE"           </span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt;  [4] "LICENSE.md"         "Makefile"           "NAMESPACE"         </span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt;  [7] "NEWS.md"            "R"                  "README.Rmd"        </span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; [10] "README.md"          "_pkgdown.yml"       "codecov.yml"       </span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; [13] "inst"               "man"                "processx.Rproj"    </span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; [16] "src"                "tests"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="spinner">Spinner<a class="anchor" aria-label="anchor" href="#spinner"></a>
</h4>
<p>The <code>spinner</code> option of <code><a href="reference/run.html">run()</a></code> puts a calming spinner to the terminal while the background program is running. The spinner is always shown in the first character of the last line, so you can make it work nicely with the regular output of the background process if you like. E.g. try this in your R terminal:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">run</span>(px,</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"out"</span>, <span class="st">"  foo"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>    <span class="st">"sleep"</span>, <span class="st">"1"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>    <span class="st">"out"</span>, <span class="st">"</span><span class="sc">\r</span><span class="st">  bar"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>    <span class="st">"sleep"</span>, <span class="st">"1"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>    <span class="st">"out"</span>, <span class="st">"</span><span class="sc">\r</span><span class="st">X foobar</span><span class="sc">\n</span><span class="st">"</span>),</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">spinner =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="callbacks-for-io">Callbacks for I/O<a class="anchor" aria-label="anchor" href="#callbacks-for-io"></a>
</h4>
<p><code><a href="reference/run.html">run()</a></code> can call an R function for each line of the standard output or error of the process, just supply the <code>stdout_line_callback</code> or the <code>stderr_line_callback</code> arguments. The callback functions take two arguments, the first one is a character scalar, the output line. The second one is the <code>process</code> object that represents the background process. (See more below about <code>process</code> objects.) You can manipulate this object in the callback, if you want. For example you can kill it in response to an error or some text on the standard output:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">line</span>, <span class="va">proc</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Got:"</span>, <span class="va">line</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">line</span> <span class="op">==</span> <span class="st">"done"</span><span class="op">)</span> <span class="va">proc</span><span class="op">$</span><span class="fu">kill</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="va">px</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"outln"</span>, <span class="st">"this"</span>, <span class="st">"outln"</span>, <span class="st">"that"</span>, <span class="st">"outln"</span>, <span class="st">"done"</span>,</span>
<span>    <span class="st">"outln"</span>, <span class="st">"still here"</span>, <span class="st">"sleep"</span>, <span class="st">"10"</span>, <span class="st">"outln"</span>, <span class="st">"dead by now"</span><span class="op">)</span>, </span>
<span>  stdout_line_callback <span class="op">=</span> <span class="va">cb</span>,</span>
<span>  error_on_status <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co">#&gt; Got: this </span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="co">#&gt; Got: that </span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co">#&gt; Got: done </span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">#&gt; Got: still here</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co">#&gt; $status</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="co">#&gt; [1] -9</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co">#&gt; $stdout</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co">#&gt; [1] "this\nthat\ndone\nstill here\n"</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co">#&gt; $stderr</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co">#&gt; [1] ""</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="co">#&gt; $timeout</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Keep in mind, that while the R callback is running, the background process is not stopped, it is also running. In the previous example, whether <code>still here</code> is printed or not depends on the scheduling of the R process and the background process by the OS. Typically, it is printed, because the R callback takes a while to run.</p>
<p>In addition to the line-oriented callbacks, the <code>stdout_callback</code> and <code>stderr_callback</code> arguments can specify callback functions that are called with output chunks instead of single lines. A chunk may contain multiple lines (separated by <code>\n</code> or <code>\r\n</code>), or even incomplete lines.</p>
</div>
</div>
<div class="section level3">
<h3 id="managing-external-processes">Managing external processes<a class="anchor" aria-label="anchor" href="#managing-external-processes"></a>
</h3>
<p>If you need better control over possibly multiple background processes, then you can use the R6 <code>process</code> class directly.</p>
<div class="section level4">
<h4 id="starting-processes">Starting processes<a class="anchor" aria-label="anchor" href="#starting-processes"></a>
</h4>
<p>To start a new background process, create a new instance of the <code>process</code> class.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/process.html">process</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"sleep"</span>, <span class="st">"20"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="killing-a-process">Killing a process<a class="anchor" aria-label="anchor" href="#killing-a-process"></a>
</h4>
<p>A process can be killed via the <code>kill()</code> method.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span><span class="op">$</span><span class="fu">is_alive</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span><span class="op">$</span><span class="fu">kill</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span><span class="op">$</span><span class="fu">is_alive</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Note that processes are finalized (and killed) automatically if the corresponding <code>process</code> object goes out of scope, as soon as the object is garbage collected by R:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/process.html">process</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"sleep"</span>, <span class="st">"20"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here, the direct call to the garbage collector kills the <code>sleep</code> process as well. See the <code>cleanup</code> option if you want to avoid this behavior.</p>
</div>
<div class="section level4">
<h4 id="standard-output-and-error">Standard output and error<a class="anchor" aria-label="anchor" href="#standard-output-and-error"></a>
</h4>
<p>By default the standard output and error of the processes are ignored. You can set the <code>stdout</code> and <code>stderr</code> constructor arguments to a file name, and then they are redirected there, or to <code>"|"</code>, and then processx creates connections to them. (Note that starting from processx 3.0.0 these connections are not regular R connections, because the public R connection API was retroactively removed from R.)</p>
<p>The <code>read_output_lines()</code> and <code>read_error_lines()</code> methods can be used to read complete lines from the standard output or error connections. They work similarly to the <code><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines()</a></code> base R function.</p>
<p>Note, that the connections have a buffer, which can fill up, if R does not read out the output, and then the process will stop, until R reads the connection and the buffer is freed.</p>
<blockquote>
<p><strong>Always make sure that you read out the standard output and/or error</strong> <strong>of the pipes, otherwise the background process will stop running!</strong></p>
</blockquote>
<p>If you don’t need the standard output or error any more, you can also close it, like this:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">get_output_connection</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">get_error_connection</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that the connections used for reading the output and error streams are non-blocking, so the read functions will return immediately, even if there is no text to read from them. If you want to make sure that there is data available to read, you need to poll, see below.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/process.html">process</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">px</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sleep"</span>, <span class="st">"1"</span>, <span class="st">"outln"</span>, <span class="st">"foo"</span>, <span class="st">"errln"</span>, <span class="st">"bar"</span>, <span class="st">"outln"</span>, <span class="st">"foobar"</span><span class="op">)</span>,</span>
<span>  stdout <span class="op">=</span> <span class="st">"|"</span>, stderr <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">read_output_lines</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co">#&gt; character(0)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span><span class="op">$</span><span class="fu">read_error_lines</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co">#&gt; character(0)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="end-of-output">End of output<a class="anchor" aria-label="anchor" href="#end-of-output"></a>
</h4>
<p>The standard R way to query the end of the stream for a non-blocking connection, is to use the <code><a href="https://rdrr.io/r/base/connections.html" class="external-link">isIncomplete()</a></code> function. <em>After a read attempt</em>, this function returns <code>FALSE</code> if the connection has surely no more data. (If the read attempt returns no data, but <code><a href="https://rdrr.io/r/base/connections.html" class="external-link">isIncomplete()</a></code> returns <code>TRUE</code>, then the connection might deliver more data in the future.</p>
<p>The <code>is_incomplete_output()</code> and <code>is_incomplete_error()</code> functions work similarly for <code>process</code> objects.</p>
</div>
<div class="section level4">
<h4 id="polling-the-standard-output-and-error">Polling the standard output and error<a class="anchor" aria-label="anchor" href="#polling-the-standard-output-and-error"></a>
</h4>
<p>The <code>poll_io()</code> method waits for data on the standard output and/or error of a process. It will return if any of the following events happen:</p>
<ul>
<li>data is available on the standard output of the process (assuming there is a connection to the standard output).</li>
<li>data is available on the standard error of the process (assuming the is a connection to the standard error).</li>
<li>The process has finished and the standard output and/or error connections were closed on the other end.</li>
<li>The specified timeout period expired.</li>
</ul>
<p>For example the following code waits about a second for output.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/process.html">process</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">px</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sleep"</span>, <span class="st">"1"</span>, <span class="st">"outln"</span>, <span class="st">"kuku"</span><span class="op">)</span>, stdout <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## No output yet</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">read_output_lines</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co">#&gt; character(0)</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Wait at most 5 sec</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">poll_io</span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="co">#&gt;   output    error  process </span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a><span class="co">#&gt;  "ready" "nopipe" "nopipe"</span></span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## There is output now</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">read_output_lines</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="co">#&gt; [1] "kuku"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="polling-multiple-processes">Polling multiple processes<a class="anchor" aria-label="anchor" href="#polling-multiple-processes"></a>
</h4>
<p>If you need to manage multiple background processes, and need to wait for output from all of them, processx defines a <code><a href="reference/poll.html">poll()</a></code> function that does just that. It is similar to the <code>poll_io()</code> method, but it takes multiple process objects, and returns as soon as one of them have data on standard output or error, or a timeout expires. Here is an example:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/process.html">process</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">px</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sleep"</span>, <span class="st">"1"</span>, <span class="st">"outln"</span>, <span class="st">"output"</span><span class="op">)</span>, stdout <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/process.html">process</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">px</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sleep"</span>, <span class="st">"2"</span>, <span class="st">"errln"</span>, <span class="st">"error"</span><span class="op">)</span>, stderr <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## After 100ms no output yet</span></span>
<span><span class="fu"><a href="reference/poll.html">poll</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p1 <span class="op">=</span> <span class="va">p1</span>, p2 <span class="op">=</span> <span class="va">p2</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="co">#&gt; $p1</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a><span class="co">#&gt;    output     error   process </span></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a><span class="co">#&gt; "timeout"  "nopipe"  "nopipe" </span></span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a><span class="co">#&gt; $p2</span></span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a><span class="co">#&gt;    output     error   process </span></span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a><span class="co">#&gt;  "nopipe" "timeout"  "nopipe"</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## But now we surely have something</span></span>
<span><span class="fu"><a href="reference/poll.html">poll</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p1 <span class="op">=</span> <span class="va">p1</span>, p2 <span class="op">=</span> <span class="va">p2</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="co">#&gt; $p1</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a><span class="co">#&gt;   output    error  process </span></span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a><span class="co">#&gt;  "ready" "nopipe" "nopipe" </span></span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a><span class="co">#&gt; $p2</span></span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a><span class="co">#&gt;   output    error  process </span></span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a><span class="co">#&gt; "nopipe" "silent" "nopipe"</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span><span class="op">$</span><span class="fu">read_output_lines</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="co">#&gt; [1] "output"</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Done with p1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">p1</span><span class="op">$</span><span class="fu">get_output_connection</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The second process should have data on stderr soonish</span></span>
<span><span class="fu"><a href="reference/poll.html">poll</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p1 <span class="op">=</span> <span class="va">p1</span>, p2 <span class="op">=</span> <span class="va">p2</span><span class="op">)</span>, <span class="fl">5000</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="co">#&gt; $p1</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a><span class="co">#&gt;   output    error  process </span></span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a><span class="co">#&gt; "closed" "nopipe" "nopipe" </span></span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a><span class="co">#&gt; $p2</span></span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a><span class="co">#&gt;   output    error  process </span></span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a><span class="co">#&gt; "nopipe"  "ready" "nopipe"</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span><span class="op">$</span><span class="fu">read_error_lines</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="co">#&gt; [1] "error"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="waiting-on-a-process">Waiting on a process<a class="anchor" aria-label="anchor" href="#waiting-on-a-process"></a>
</h4>
<p>As seen before, <code>is_alive()</code> checks if a process is running. The <code>wait()</code> method can be used to wait until it has finished (or a specified timeout expires).. E.g. in the following code <code>wait()</code> needs to wait about 2 seconds for the <code>sleep</code> <code>px</code> command to finish.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/process.html">process</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">px</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sleep"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">is_alive</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="co">#&gt; [1] "2022-06-10 13:57:49 CEST"</span></span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="co">#&gt; [1] "2022-06-10 13:57:51 CEST"</span></span></code></pre></div>
<p>It is safe to call <code>wait()</code> multiple times:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="op">)</span> <span class="co"># already finished!</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="exit-statuses">Exit statuses<a class="anchor" aria-label="anchor" href="#exit-statuses"></a>
</h4>
<p>After a process has finished, its exit status can be queried via the <code>get_exit_status()</code> method. If the process is still running, then this method returns <code>NULL</code>.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/process.html">process</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">px</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sleep"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">get_exit_status</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">get_exit_status</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mixing-processx-and-the-parallel-base-r-package">Mixing processx and the parallel base R package<a class="anchor" aria-label="anchor" href="#mixing-processx-and-the-parallel-base-r-package"></a>
</h4>
<p>In general, mixing processx (via callr or not) and parallel works fine. If you use parallel’s ‘fork’ clusters, e.g. via <code><a href="https://rdrr.io/r/parallel/mcparallel.html" class="external-link">parallel::mcparallel()</a></code>, then you might see two issues. One is that processx will not be able to determine the exit status of some processx processes. This is because the status is read out by parallel, and processx will set it to <code>NA</code>. The other one is that parallel might complain that it could not clean up some subprocesses. This is not an error, and it is harmless, but it does hold up R for about 10 seconds, before parallel gives up. To work around this, you can set the <code>PROCESSX_NOTIFY_OLD_SIGCHLD</code> environment variable to a non-empty value, before you load processx. This behavior might be the default in the future.</p>
</div>
<div class="section level4">
<h4 id="errors-1">Errors<a class="anchor" aria-label="anchor" href="#errors-1"></a>
</h4>
<p>Errors are typically signalled via non-zero exits statuses. The processx constructor fails if the external program cannot be started, but it does not deal with errors that happen after the program has successfully started running.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/process.html">process</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"nonexistant-command-for-sure"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="co">#&gt; Error in c("process_initialize(self, private, command, args, stdin, stdout, ", : ! Native call to `processx_exec` failed</span></span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a><span class="co">#&gt; Caused by error in `chain_call(c_processx_exec, command, c(command, args), pty, pty_options, …` at initialize.R:138:3:</span></span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a><span class="co">#&gt; ! cannot start processx process 'nonexistant-command-for-sure' (system error 2, No such file or directory) @unix/processx.c:613 (processx_exec)</span></span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/process.html">process</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">px</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sleep"</span>, <span class="st">"1"</span>, <span class="st">"command-does-not-exist"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p2</span><span class="op">$</span><span class="fu">get_exit_status</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="co">#&gt; [1] 5</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="related-tools">Related tools<a class="anchor" aria-label="anchor" href="#related-tools"></a>
</h2>
<ul>
<li><p>The <a href="https://ps.r-lib.org/" class="external-link"><code>ps</code> package</a> can query, list, manipulate all system processes (not just subprocesses), and processx uses it internally for some of its functionality. You can also convert a <code><a href="reference/process.html">processx::process</a></code> object to a <code><a href="https://ps.r-lib.org/reference/ps_handle.html" class="external-link">ps::ps_handle</a></code> with the <code>as_ps_handle()</code> method.</p></li>
<li><p>The <a href="https://callr.r-lib.org/" class="external-link"><code>callr</code> package</a> uses processx to start another R process, and run R code in it, in the foreground or background.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the processx project is released with a <a href="https://processx.r-lib.org/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT © Ascent Digital Services, RStudio, Gábor Csárdi</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=processx" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/r-lib/processx/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/r-lib/processx/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing processx</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Gábor Csárdi <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0001-7098-9676" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Winston Chang <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a> <br><small class="roles"> Copyright holder, funder </small>  </li>
<li>Ascent Digital Services <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html" class="external-link"><img src="https://lifecycle.r-lib.org/articles/figures/lifecycle-stable.svg" alt="lifecycle"></a></li>
<li><a href="https://github.com/r-lib/processx/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/r-lib/processx/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://www.r-pkg.org/pkg/processx" class="external-link"><img src="https://www.r-pkg.org/badges/version/processx"></a></li>
<li><a href="https://www.r-pkg.org/pkg/processx" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/processx" alt="CRAN RStudio mirror downloads"></a></li>
<li><a href="https://app.codecov.io/gh/r-lib/processx?branch=main" class="external-link"><img src="https://codecov.io/gh/r-lib/processx/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Gábor Csárdi, Winston Chang, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>, Ascent Digital Services.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

  </div></footer>
</body>
</html>
