<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run external command, and wait until finishes — run • processx</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run external command, and wait until finishes — run"><meta name="description" content="run provides an interface similar to base::system() and
base::system2(), but based on the process class. This allows some
extra features, see below."><meta property="og:description" content="run provides an interface similar to base::system() and
base::system2(), but based on the process class. This allows some
extra features, see below."><meta name="robots" content="noindex"><script defer data-domain="processx.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">processx</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.8.5.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/internals.html">processx internals</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/processx/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Run external command, and wait until finishes</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/processx/blob/main/R/run.R" class="external-link"><code>R/run.R</code></a></small>
      <div class="d-none name"><code>run.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>run</code> provides an interface similar to <code><a href="https://rdrr.io/r/base/system.html" class="external-link">base::system()</a></code> and
<code><a href="https://rdrr.io/r/base/system2.html" class="external-link">base::system2()</a></code>, but based on the <a href="process.html">process</a> class. This allows some
extra features, see below.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run</span><span class="op">(</span></span>
<span>  command <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  error_on_status <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  wd <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  echo_cmd <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  echo <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  spinner <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  timeout <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  stdout <span class="op">=</span> <span class="st">"|"</span>,</span>
<span>  stderr <span class="op">=</span> <span class="st">"|"</span>,</span>
<span>  stdout_line_callback <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stdout_callback <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stderr_line_callback <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stderr_callback <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stderr_to_stdout <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  env <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  windows_verbatim_args <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  windows_hide_window <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  encoding <span class="op">=</span> <span class="st">""</span>,</span>
<span>  cleanup_tree <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-command">command<a class="anchor" aria-label="anchor" href="#arg-command"></a></dt>
<dd><p>Character scalar, the command to run. If you are
running <code>.bat</code> or <code>.cmd</code> files on Windows, make sure you read the
'Batch files' section in the <a href="process.html">process</a> manual page.</p></dd>


<dt id="arg-args">args<a class="anchor" aria-label="anchor" href="#arg-args"></a></dt>
<dd><p>Character vector, arguments to the command.</p></dd>


<dt id="arg-error-on-status">error_on_status<a class="anchor" aria-label="anchor" href="#arg-error-on-status"></a></dt>
<dd><p>Whether to throw an error if the command returns
with a non-zero status, or it is interrupted. The error classes are
<code>system_command_status_error</code> and <code>system_command_timeout_error</code>,
respectively, and both errors have class <code>system_command_error</code> as
well. See also "Error conditions" below.</p></dd>


<dt id="arg-wd">wd<a class="anchor" aria-label="anchor" href="#arg-wd"></a></dt>
<dd><p>Working directory of the process. If <code>NULL</code>, the current
working directory is used.</p></dd>


<dt id="arg-echo-cmd">echo_cmd<a class="anchor" aria-label="anchor" href="#arg-echo-cmd"></a></dt>
<dd><p>Whether to print the command to run to the screen.</p></dd>


<dt id="arg-echo">echo<a class="anchor" aria-label="anchor" href="#arg-echo"></a></dt>
<dd><p>Whether to print the standard output and error
to the screen. Note that the order of the standard output and error
lines are not necessarily correct, as standard output is typically
buffered. If the standard output and/or error is redirected to a
file or they are ignored, then they also not echoed.</p></dd>


<dt id="arg-spinner">spinner<a class="anchor" aria-label="anchor" href="#arg-spinner"></a></dt>
<dd><p>Whether to show a reassuring spinner while the process
is running.</p></dd>


<dt id="arg-timeout">timeout<a class="anchor" aria-label="anchor" href="#arg-timeout"></a></dt>
<dd><p>Timeout for the process, in seconds, or as a <code>difftime</code>
object. If it is not finished before this, it will be killed.</p></dd>


<dt id="arg-stdout">stdout<a class="anchor" aria-label="anchor" href="#arg-stdout"></a></dt>
<dd><p>What to do with the standard output. By default it
is collected in the result, and you can also use the
<code>stdout_line_callback</code> and <code>stdout_callback</code> arguments to pass
callbacks for output. If it is the empty string (<code>""</code>), then
the child process inherits the standard output stream of the
R process. (If the main R process does not have a standard output
stream, e.g. in RGui on Windows, then an error is thrown.)
If it is <code>NULL</code>, then standard output is discarded. If it is a string
other than <code>"|"</code> and <code>""</code>, then it is taken as a file name and the
output is redirected to this file.</p></dd>


<dt id="arg-stderr">stderr<a class="anchor" aria-label="anchor" href="#arg-stderr"></a></dt>
<dd><p>What to do with the standard error. By default it
is collected in the result, and you can also use the
<code>stderr_line_callback</code> and <code>stderr_callback</code> arguments to pass
callbacks for output. If it is the empty string (<code>""</code>), then
the child process inherits the standard error stream of the
R process. (If the main R process does not have a standard error
stream, e.g. in RGui on Windows, then an error is thrown.)
If it is <code>NULL</code>, then standard error is discarded. If it is a string
other than <code>"|"</code> and <code>""</code>, then it is taken as a file name and the
standard error is redirected to this file.</p></dd>


<dt id="arg-stdout-line-callback">stdout_line_callback<a class="anchor" aria-label="anchor" href="#arg-stdout-line-callback"></a></dt>
<dd><p><code>NULL</code>, or a function to call for every
line of the standard output. See <code>stdout_callback</code> and also more
below.</p></dd>


<dt id="arg-stdout-callback">stdout_callback<a class="anchor" aria-label="anchor" href="#arg-stdout-callback"></a></dt>
<dd><p><code>NULL</code>, or a function to call for every chunk
of the standard output. A chunk can be as small as a single character.
At most one of <code>stdout_line_callback</code> and <code>stdout_callback</code> can be
non-<code>NULL</code>.</p></dd>


<dt id="arg-stderr-line-callback">stderr_line_callback<a class="anchor" aria-label="anchor" href="#arg-stderr-line-callback"></a></dt>
<dd><p><code>NULL</code>, or a function to call for every
line of the standard error. See <code>stderr_callback</code> and also more
below.</p></dd>


<dt id="arg-stderr-callback">stderr_callback<a class="anchor" aria-label="anchor" href="#arg-stderr-callback"></a></dt>
<dd><p><code>NULL</code>, or a function to call for every chunk
of the standard error. A chunk can be as small as a single character.
At most one of <code>stderr_line_callback</code> and <code>stderr_callback</code> can be
non-<code>NULL</code>.</p></dd>


<dt id="arg-stderr-to-stdout">stderr_to_stdout<a class="anchor" aria-label="anchor" href="#arg-stderr-to-stdout"></a></dt>
<dd><p>Whether to redirect the standard error to the
standard output. Specifying <code>TRUE</code> here will keep both in the
standard output, correctly interleaved. However, it is not possible
to deduce where pieces of the output were coming from. If this is
<code>TRUE</code>, the standard error callbacks  (if any) are never called.</p></dd>


<dt id="arg-env">env<a class="anchor" aria-label="anchor" href="#arg-env"></a></dt>
<dd><p>Environment variables of the child process. If <code>NULL</code>,
the parent's environment is inherited. On Windows, many programs
cannot function correctly if some environment variables are not
set, so we always set <code>HOMEDRIVE</code>, <code>HOMEPATH</code>, <code>LOGONSERVER</code>,
<code>PATH</code>, <code>SYSTEMDRIVE</code>, <code>SYSTEMROOT</code>, <code>TEMP</code>, <code>USERDOMAIN</code>,
<code>USERNAME</code>, <code>USERPROFILE</code> and <code>WINDIR</code>. To append new environment
variables to the ones set in the current process, specify
<code>"current"</code> in <code>env</code>, without a name, and the appended ones with
names. The appended ones can overwrite the current ones.</p></dd>


<dt id="arg-windows-verbatim-args">windows_verbatim_args<a class="anchor" aria-label="anchor" href="#arg-windows-verbatim-args"></a></dt>
<dd><p>Whether to omit the escaping of the
command and the arguments on windows. Ignored on other platforms.</p></dd>


<dt id="arg-windows-hide-window">windows_hide_window<a class="anchor" aria-label="anchor" href="#arg-windows-hide-window"></a></dt>
<dd><p>Whether to hide the window of the
application on windows. Ignored on other platforms.</p></dd>


<dt id="arg-encoding">encoding<a class="anchor" aria-label="anchor" href="#arg-encoding"></a></dt>
<dd><p>The encoding to assume for <code>stdout</code> and
<code>stderr</code>. By default the encoding of the current locale is
used. Note that <code>processx</code> always reencodes the output of
both streams in UTF-8 currently.</p></dd>


<dt id="arg-cleanup-tree">cleanup_tree<a class="anchor" aria-label="anchor" href="#arg-cleanup-tree"></a></dt>
<dd><p>Whether to clean up the child process tree after
the process has finished.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Extra arguments are passed to <code>process$new()</code>, see
<a href="process.html">process</a>. Note that you cannot pass <code>stout</code> or <code>stderr</code> here,
because they are used internally by <code>run()</code>. You can use the
<code>stdout_callback</code>, <code>stderr_callback</code>, etc. arguments to manage
the standard output and error, or the <a href="process.html">process</a> class directly
if you need more flexibility.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with components:</p><ul><li><p>status The exit status of the process. If this is <code>NA</code>, then the
process was killed and had no exit status.</p></li>
<li><p>stdout The standard output of the command, in a character scalar.</p></li>
<li><p>stderr The standard error of the command, in a character scalar.</p></li>
<li><p>timeout Whether the process was killed because of a timeout.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>run</code> supports</p><ul><li><p>Specifying a timeout for the command. If the specified time has
passed, and the process is still running, it will be killed
(with all its child processes).</p></li>
<li><p>Calling a callback function for each line or each chunk of the
standard output and/or error. A chunk may contain multiple lines, and
can be as short as a single character.</p></li>
<li><p>Cleaning up the subprocess, or the whole process tree, before exiting.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="callbacks">Callbacks<a class="anchor" aria-label="anchor" href="#callbacks"></a></h2>



<p>Some notes about the callback functions. The first argument of a
callback function is a character scalar (length 1 character), a single
output or error line. The second argument is always the <a href="process.html">process</a>
object. You can manipulate this object, for example you can call
<code>$kill()</code> on it to terminate it, as a response to a message on the
standard output or error.</p>
    </div>
    <div class="section level2">
    <h2 id="error-conditions">Error conditions<a class="anchor" aria-label="anchor" href="#error-conditions"></a></h2>



<p><code>run()</code> throws error condition objects if the process is interrupted,
timeouts or fails (if <code>error_on_status</code> is <code>TRUE</code>):</p><ul><li><p>On interrupt, a condition with classes <code>system_command_interrupt</code>,
<code>interrupt</code>, <code>condition</code> is signalled. This can be caught with
<code>tryCatch(..., interrupt = ...)</code>.</p></li>
<li><p>On timeout, a condition with classes <code>system_command_timeout_error</code>,
<code>system_command_error</code>, <code>error</code>, <code>condition</code> is thrown.</p></li>
<li><p>On error (if <code>error_on_status</code> is <code>TRUE</code>), an error with classes
<code>system_command_status_error</code>, <code>system_command_error</code>, <code>error</code>,
<code>condition</code> is thrown.</p></li>
</ul><p>All of these conditions have the fields:</p><ul><li><p><code>message</code>: the error message,</p></li>
<li><p><code>stderr</code>: the standard error of the process, or the standard output
of the process if <code>stderr_to_stdout</code> was <code>TRUE</code>.</p></li>
<li><p><code>call</code>: the captured call to <code>run()</code>.</p></li>
<li><p><code>echo</code>: the value of the <code>echo</code> argument.</p></li>
<li><p><code>stderr_to_stdout</code>: the value of the <code>stderr_to_stdout</code> argument.</p></li>
<li><p><code>status</code>: the exit status for <code>system_command_status_error</code> errors.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># This works on Unix systems</span></span></span>
<span class="r-in"><span><span class="fu">run</span><span class="op">(</span><span class="st">"ls"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $status</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $stdout</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "base64_decode.html\ncurl_fds.html\ndefault_pty_options.html\nfigures\nindex.html\npoll.html\nprocess.html\nprocess_initialize.html\nprocessx-package.html\nprocessx_connections.html\nprocessx_fifos.html\nprocessx_sockets.html\n"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $stderr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] ""</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $timeout</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">run</span><span class="op">(</span><span class="st">"sleep"</span>, <span class="st">"10"</span>, timeout <span class="op">=</span> <span class="fl">1</span>, error_on_status <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.004   0.011   0.514 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">run</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"sh"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-c"</span>, <span class="st">"for i in 1 2 3 4 5; do echo $i; sleep 1; done"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    timeout <span class="op">=</span> <span class="fl">2</span>, error_on_status <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.005   0.009   1.516 </span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># This works on Windows systems, if the ping command is available</span></span></span>
<span class="r-in"><span><span class="fu">run</span><span class="op">(</span><span class="st">"ping"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-n"</span>, <span class="st">"1"</span>, <span class="st">"127.0.0.1"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">run</span><span class="op">(</span><span class="st">"ping"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-n"</span>, <span class="st">"6"</span>, <span class="st">"127.0.0.1"</span><span class="op">)</span>, timeout <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>    error_on_status <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Gábor Csárdi, Winston Chang, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>, Ascent Digital Services.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

